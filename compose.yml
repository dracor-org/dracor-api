services:
  api:
    image: dracor/api
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - FUSEKI_SERVER=http://fuseki:3030/dracor/
        - METRICS_SERVER=http://metrics:8030/metrics/
        - FUSEKI_SECRET=qwerty
        - GITHUB_WEBHOOK_SECRET=qwerty
    environment:
      - DRACOR_API_BASE=http://localhost:8088/api/v1
    ports:
      - 8080:8080
    volumes:
      - existdata:/opt/exist/data
      - .:/tmp/export
    depends_on:
      - fuseki
      - metrics
  fuseki:
    image: dracor/fuseki:1.1.2
    environment:
      - ADMIN_PASSWORD=qwerty
    ports:
      - 3030:3030
    expose:
      - 3030
    volumes:
      - fusekidata:/fuseki
  metrics:
    image: dracor/metrics:1.3.2
    ports:
      - 8030:8030
  frontend:
    image: dracor/frontend:2.0.2
    environment:
      DRACOR_API: http://api:8080/exist/restxq/v1
    ports:
      - 8088:80
    depends_on:
      - api
volumes:
  existdata:
  fusekidata:
